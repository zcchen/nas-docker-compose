version: "3.5"

services:
  shadowsocks:
    image: mritd/shadowsocks
    restart: on-failure
    expose:
      - 8080
    networks:
      - front-end
    secrets:
      - proxy-shadowsocks-config
    entrypoint: |
      ss-server -c /run/secrets/proxy-shadowsocks-config \
                -p 8080 --plugin v2ray-plugin \
                --plugin-opts 'server'
    #environment:
      #SS_MODULE: ss-server
      #SS_CONFIG:" "-c /run/secrets/proxy-shadowsocks-config -s 0.0.0.0"
    labels:
      traefik.enable: true
      traefik.http.routers.shadowsocks.rule: "Host(`ss.${SERVER_DOMAIN_NAME}`)"
      traefik.http.routers.shadowsocks.priority: 99
      traefik.http.routers.shadowsocks.service: shadowsocks
      traefik.http.services.shadowsocks.loadbalancer.server.port: 8080
      traefik.tcp.routers.shadowsocks.rule: "HostSNI(`*`)"
      traefik.tcp.routers.shadowsocks.service: shadowsocks
      traefik.tcp.services.shadowsocks.loadbalancer.server.port: 8080

secrets:
  proxy-shadowsocks-config:
    file: ../configs/secrets/proxy/shadowsocks-config.json
