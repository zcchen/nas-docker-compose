location ^~ /.well-known {
	# The rules in this block are an adaptation of the rules
	# in the Nextcloud `.htaccess` that concern `/.well-known`.

	location = /.well-known/carddav { return 301 /nextcloud/remote.php/dav/; }
	location = /.well-known/caldav  { return 301 /nextcloud/remote.php/dav/; }

	location /.well-known/acme-challenge    { try_files $uri $uri/ =404; }
	location /.well-known/pki-validation    { try_files $uri $uri/ =404; }

	# Let Nextcloud's API for `/.well-known` URIs handle all other
	# requests by passing them to the front-end controller.
	location ^~ /.well-known          { return 301 /nextcloud/index.php$uri; }

	try_files $uri $uri/ =404;
}

location ^~ /nextcloud {
	rewrite ^/nextcloud(/.*)$ $1 last;
	client_max_body_size 512M;

	proxy_pass http://nextcloud-web/;
	proxy_cookie_path / /nextcloud/;
	include conf.d/modules/uri-proxy.conf;

	# Rule borrowed from `.htaccess`
	location /nextcloud/remote {
		return 301 /nextcloud/remote.php$uri;
	}

	location /nextcloud {
		#try_files $uri $uri/ /nextcloud/index.php$request_uri;
		try_files $uri $uri/;
	}
}

# vim: ft=nginx noexpandtab
