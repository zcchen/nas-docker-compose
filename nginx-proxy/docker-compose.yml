version: "3.5"

services:
  nginx:
    image: nginx:alpine
    container_name: nginx
    ports:
      - 80:80
      - 433:433
    volumes:
      - nginx:/etc/nginx/conf.d
      #- nginx:/etc/nginx/certs
    networks:
      - front_end
      - mid_layout

  dockergen:
    image: jwilder/docker-gen
    container_name: dockergen
    restart: on-failure
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock:ro
      - dockergen:/etc/docker-gen/templates
      - nginx:/etc/nginx/conf.d/
    network_mode: "none"
    command: |
      -notify-sighup nginx
      -watch -only-exposed
      /etc/docker-gen/templates/nginx-default.conf.tmpl /etc/nginx/conf.d/default.conf


volumes:

  nginx:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${DATA_FOLDER}/nginx-proxy/

  dockergen:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${PWD}/nginx-proxy/templates/


